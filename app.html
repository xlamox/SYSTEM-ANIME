<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>RISE SYSTEM™</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@200..800&family=IBM+Plex+Sans+Arabic:wght@100..700&display=swap" rel="stylesheet">

  <style>
    :root{
      --background: 235 35% 6%;
      --foreground: 210 40% 96%;
      --chart-1: 195 100% 55%;
      --chart-2: 280 85% 64%;
      --chart-3: 155 80% 48%;
      --chart-4: 35 95% 58%;
      --chart-5: 0 84% 60%;
      --font-sans: "IBM Plex Sans Arabic", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      --font-display: "Oxanium", "IBM Plex Sans Arabic", system-ui, sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font-sans);
      color:hsl(var(--foreground));
      background:hsl(var(--background));
      overflow-x:hidden;
    }

    .bg-anim{
      position:fixed;
      inset:-18%;
      z-index:-2;
      background:
        radial-gradient(1200px 900px at 20% 25%, hsl(var(--chart-2) / 0.22), transparent 60%),
        radial-gradient(1100px 850px at 80% 30%, hsl(var(--chart-1) / 0.22), transparent 62%),
        radial-gradient(1000px 800px at 25% 85%, hsl(var(--chart-3) / 0.18), transparent 60%),
        radial-gradient(900px 700px at 85% 80%, hsl(var(--chart-4) / 0.10), transparent 62%),
        linear-gradient(to bottom, hsl(235 35% 6%), hsl(240 32% 7%));
      background-size: 140% 140%;
      animation: spaceDrift 18s ease-in-out infinite;
      transform: translateZ(0);
      will-change: transform, filter, background-position;
    }
    .bg-anim::before{
      content:"";
      position:absolute; inset:0;
      background:
        conic-gradient(from 210deg at 50% 50%,
          transparent 0deg,
          hsl(var(--chart-1) / 0.07) 70deg,
          transparent 140deg,
          hsl(var(--chart-2) / 0.07) 220deg,
          transparent 360deg);
      filter: blur(20px);
      opacity: .95;
      animation: nebulaSpin 28s linear infinite;
      mix-blend-mode: screen;
      pointer-events:none;
    }
    .bg-anim::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,.12) 0 1px, transparent 2px),
        radial-gradient(circle at 35% 40%, rgba(255,255,255,.10) 0 1px, transparent 2px),
        radial-gradient(circle at 70% 25%, rgba(255,255,255,.12) 0 1px, transparent 2px),
        radial-gradient(circle at 85% 55%, rgba(255,255,255,.10) 0 1px, transparent 2px),
        radial-gradient(circle at 20% 80%, rgba(255,255,255,.10) 0 1px, transparent 2px),
        radial-gradient(circle at 55% 78%, rgba(255,255,255,.08) 0 1px, transparent 2px);
      opacity:.55;
      filter: blur(.2px);
      animation: starsFloat 14s ease-in-out infinite;
      pointer-events:none;
    }

    @keyframes spaceDrift{
      0%   { background-position: 45% 55%; transform: scale(1); filter: hue-rotate(0deg); }
      50%  { background-position: 60% 40%; transform: scale(1.03); filter: hue-rotate(10deg); }
      100% { background-position: 45% 55%; transform: scale(1); filter: hue-rotate(0deg); }
    }
    @keyframes nebulaSpin{ from{ transform: rotate(0deg); } to{ transform: rotate(360deg); } }
    @keyframes starsFloat{
      0%   { transform: translate(0px,0px); opacity:.50; }
      50%  { transform: translate(14px,-10px); opacity:.60; }
      100% { transform: translate(0px,0px); opacity:.50; }
    }

    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
    .wrap{max-width:1100px; margin:0 auto; padding:28px 16px 40px;}

    .header{position:relative}
    .hero-glow{
      position:absolute; top:-40px; left:50%; transform:translateX(-50%);
      width:760px; height:200px; border-radius:999px;
      background: radial-gradient(circle at center, hsl(var(--chart-1) / 0.28), transparent 62%);
      filter: blur(22px);
      pointer-events:none;
      opacity:.9;
    }

    .top-row{display:flex; gap:16px; align-items:flex-end; justify-content:space-between; flex-wrap:wrap;}

    .badge{
      display:inline-flex; align-items:center; gap:10px;
      padding:8px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      font-size:12px; color: rgba(255,255,255,.92);
    }
    .dot{width:10px;height:10px;border-radius:50%; background:hsl(var(--chart-1)); box-shadow: 0 0 18px hsl(var(--chart-1) / .60);}
    .brand-name{font-family:var(--font-display); letter-spacing:.6px}
    .brand-sub{color:rgba(255,255,255,.60)}

    .title{margin:12px 0 6px; font-family:var(--font-display); font-size:40px; line-height:1.1;}
    .subtitle{margin:0; max-width:680px; color:rgba(255,255,255,.78); font-size:14.5px; line-height:1.7;}

    .chips{margin-top:12px; display:flex; flex-wrap:wrap; gap:8px;}
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      font-size:12px; color: rgba(255,255,255,.82);
    }
    .chip-mono{font-family: ui-monospace, monospace; color: rgba(255,255,255,.92)}

    .stats{display:grid; grid-template-columns:repeat(3, 1fr); gap:10px; width:360px; max-width:100%;}
    .stat{
      border-radius:18px; padding:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.20);
    }
    .stat-k{font-size:11px; letter-spacing:2px; color: rgba(255,255,255,.72)}
    .stat-v{margin-top:6px; font-family:var(--font-display); font-size:22px}
    .stat-s{margin-top:4px; font-size:11px; color: rgba(255,255,255,.66)}
    .stat-hp{border-color:hsl(var(--chart-3) / .35); background:hsl(var(--chart-3) / .12)}
    .stat-level{border-color:hsl(var(--chart-1) / .35); background:hsl(var(--chart-1) / .12)}
    .stat-rank{border-color:hsl(var(--chart-2) / .35); background:hsl(var(--chart-2) / .12)}

    .locked{
      margin-top:16px; border-radius:18px;
      border:1px solid hsl(var(--chart-5) / .35);
      background:hsl(var(--chart-5) / .12);
      padding:10px 14px;
    }
    .locked-row{display:flex; justify-content:space-between; align-items:center; gap:10px; color: rgba(255,255,255,.95); font-size:13px;}

    .main{margin-top:22px; display:grid; gap:14px; grid-template-columns:1.35fr .65fr;}
    @media (max-width:980px){ .main{grid-template-columns:1fr} }

    .card{
      border-radius:24px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.20);
      padding:14px;
    }

    .label{font-size:11px; letter-spacing:2px; color: rgba(255,255,255,.70)}
    .section-title{margin-top:6px; font-family:var(--font-display); font-size:18px}
    .muted{color: rgba(255,255,255,.70); font-size:12px}
    .tiny{display:flex; justify-content:space-between; gap:10px; color: rgba(255,255,255,.64); font-size:11px}

    .card-row{display:flex; gap:12px; align-items:flex-end; justify-content:space-between; flex-wrap:wrap;}
    .quote{margin-top:6px; font-family:var(--font-display); font-size:18px; color: rgba(255,255,255,.95);}

    .progress-row{display:flex; gap:14px; align-items:flex-end; justify-content:space-between; flex-wrap:wrap;}
    .big{margin-top:6px; font-family: var(--font-display); font-size:34px}

    .progress-side{width:280px; max-width:100%}
    .bar{width:100%; height:10px; border-radius:999px; background: rgba(255,255,255,.12); overflow:hidden;}
    .fill{height:100%; width:0%; background:hsl(var(--chart-1)); box-shadow: 0 0 18px hsl(var(--chart-1)/.35); transition: width .25s ease; }

    .task-list{margin-top:12px; display:grid; gap:10px;}
    .task{border-radius:18px; border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); padding:12px;}
    .task-top{display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;}

    .tag{
      display:inline-flex; align-items:center; gap:8px;
      border-radius:999px; border:1px solid rgba(255,255,255,.18);
      padding:6px 10px; font-size:11px;
    }
    .tag.ph{background:hsl(var(--chart-3)/.16); color:hsl(var(--chart-3)); border-color:hsl(var(--chart-3)/.28)}
    .tag.iq{background:hsl(var(--chart-1)/.16); color:hsl(var(--chart-1)); border-color:hsl(var(--chart-1)/.28)}
    .tag.sp{background:hsl(var(--chart-2)/.16); color:hsl(var(--chart-2)); border-color:hsl(var(--chart-2)/.28)}

    .task-title{font-family:var(--font-display); font-size:15px; color: rgba(255,255,255,.96); max-width:360px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .task-meta{margin-top:6px; display:flex; flex-wrap:wrap; gap:10px; font-size:11px; color: rgba(255,255,255,.70)}

    .task-controls{display:flex; align-items:center; gap:8px;}
    .input{
      width:100%; padding:10px 12px; border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.96);
      outline:none;
    }
    .input:disabled{opacity:.6}
    .small{width:92px; padding:8px 10px; border-radius:14px;}

    .btn{
      cursor:pointer; border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.96);
      padding:10px 14px;
      border-radius:18px;
      transition:.15s;
    }
    .btn:hover{background: rgba(255,255,255,.10)}
    .btn:disabled{opacity:.55; cursor:not-allowed}
    .btn-ghost{background: rgba(255,255,255,.06)}
    .btn-green{
      width:44px; padding:10px 0;
      border-color:hsl(var(--chart-3)/.30);
      background:hsl(var(--chart-3)/.18);
    }
    .btn-green:hover{background:hsl(var(--chart-3)/.24)}

    .add-grid{margin-top:12px; display:grid; gap:10px; grid-template-columns: 1.4fr .6fr .6fr .6fr .2fr;}
    @media (max-width:980px){ .add-grid{grid-template-columns:1fr 1fr;} .btn-green{width:100%} }

    .radar-wrap{
      margin-top:10px; width:100%;
      border-radius:18px; border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      overflow:hidden; display:flex; justify-content:center; align-items:center;
      padding:8px;
    }
    .radar-wrap canvas{max-width:100%; height:auto}

    .mini-stats{margin-top:10px; display:grid; grid-template-columns:repeat(3,1fr); gap:10px;}
    .mini{border-radius:18px; border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); padding:10px;}
    .mini-v{font-family:var(--font-display); font-size:20px;}
    .mini-v span{font-size:12px; color: rgba(255,255,255,.55)}
    .mini-l{margin-top:4px; font-size:11px; color: rgba(255,255,255,.68)}

    .note{
      margin-top:10px; border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      padding:10px;
      color: rgba(255,255,255,.78);
      font-size:13px; line-height:1.65;
    }

    .chart-wrap{
      margin-top:10px; width:100%;
      border-radius:18px; border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      overflow:hidden;
      padding:10px;
    }
    .chart-wrap canvas{width:100%; height:auto; display:block}

    .footer{
      margin-top:18px; padding-top:14px;
      border-top:1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.70);
      font-size:12px;
      display:flex; flex-direction:column; gap:6px;
    }

    .countdown{
      margin-top:10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
    }
  </style>
</head>

<body>
  <div class="bg-anim"></div>
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script>
    const h = React.createElement;
    const { useEffect, useMemo, useRef, useState } = React;

    const TYPE_META = {
      PH: { label: "قوة جسدية", multiplier: 2.0 },
      IQ: { label: "ذكاء وتعلّم", multiplier: 1.7 },
      SP: { label: "انضباط وروحانية", multiplier: 1.5 },
    };

    const RANKS = [
      { key: "E", days: 0,   label: "E" },
      { key: "D", days: 7,   label: "D" },
      { key: "C", days: 30,  label: "C" },
      { key: "B", days: 90,  label: "B" },
      { key: "A", days: 180, label: "A" },
      { key: "S", days: 365, label: "S Elite" },
    ];

    const RANK_PENALTY = { E:0, D:1, C:3, B:7, A:14, S:30 };

    const QUOTES = [
      "أنت لا تبحث عن الحماس… أنت تبني الانضباط.",
      "اليوم ليس اختبارًا لقوتك… بل لالتزامك.",
      "خطوة واحدة يوميًا تُصنع منها الأساطير.",
      "كل مهمة تُنجزها = مستوى جديد في شخصيتك.",
      "لا تُفاوض على عاداتك الأساسية.",
      "النتائج لا تأتي بسرعة… لكنّها تأتي بثبات.",
      "الفارق بينك وبين هدفك: يوم واحد من الالتزام.",
      "الضعف لحظة… والاستسلام قرار.",
      "خفّف الضوضاء. زد التنفيذ.",
      "إذا بدأت اليوم، ستشكر نفسك بعد أسبوع.",
      "إلتزم عندما لا تشعر بالرغبة—هنا تتغير الشخصية.",
      "كل مرة تقول (لاحقًا) أنت تسرق من مستقبلك.",
      "لا تنتظر المزاج. المزاج يتبع الحركة.",
      "أنت تبني (نظام)… وليس (قائمة مهام).",
      "الضغط جزء من التطور. لا تهرب منه.",
    ];

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }
    function pct(n){ return Math.round(n * 100); }

    function todayKeyLocal(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      return `${y}-${m}-${day}`;
    }

    function randomQuote(seed){
      let hh = 0;
      for(let i=0;i<seed.length;i++) hh = (hh*31 + seed.charCodeAt(i)) >>> 0;
      return QUOTES[hh % QUOTES.length];
    }

    function expToLevel(totalExp){
      const a = 120;
      let level = 1;
      let expForNext = a;
      let remaining = totalExp;
      while(remaining >= expForNext){
        remaining -= expForNext;
        level += 1;
        expForNext = Math.round(a * Math.pow(level, 1.15));
        if(level > 200) break;
      }
      return { level, expIntoLevel: remaining, expForNext };
    }

    function rankFromStreak(days){
      let cur = RANKS[0];
      for(const r of RANKS) if(days >= r.days) cur = r;
      return cur;
    }

    function msToMidnight(){
      const now = new Date();
      const midnight = new Date(now);
      midnight.setHours(24,0,0,0);
      return midnight.getTime() - now.getTime();
    }

    function formatCountdown(ms){
      const total = Math.max(0, ms);
      const s = Math.floor(total/1000);
      const hh = Math.floor(s/3600);
      const mm = Math.floor((s%3600)/60);
      const ss = s%60;
      return `${String(hh).padStart(2,"0")}:${String(mm).padStart(2,"0")}:${String(ss).padStart(2,"0")}`;
    }

    const STORAGE_KEY = "RISE_SYSTEM_INDEX_FULL_V7";
    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return null;
        return JSON.parse(raw);
      }catch{ return null; }
    }
    function saveState(s){ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); }

    /* ============================================================
       ✅ NEW: Daily Max EXP + Harsh penalty scaling (no other changes)
       ============================================================ */
    function dailyMaxExpByLevel(level){
      // سقف الربح اليومي: يزيد تدريجياً (منطقي)
      // L1 ~ 220 / L20 ~ 310 / L50 ~ 410 تقريباً
      return Math.round(220 + 18 * Math.log2(level + 1) + 0.8 * Math.sqrt(level));
    }

    function penaltyRatioByLevel(level){
      // ✅ قاسي جداً بالمستويات المتقدمة:
      // يبدأ 0.95 ويصعد حتى 2.20 (خصم أكثر من يومين EXP)
      return clamp(0.95 + (Math.max(1, level) - 1) * 0.03, 0.95, 2.20);
    }

    function expPenaltyByLevel(level){
      const dailyMax = dailyMaxExpByLevel(level);
      return Math.round(dailyMax * penaltyRatioByLevel(level));
    }

    /* ============================================================
       ✅ computeToday updated: EXP based on ratios + importance + type
       ============================================================ */
    function computeToday(tasks, level){
      const totals = {
        scoreDone: 0,
        scoreTotal: 0,
        completion: 0,
        exp: 0,
        expMax: 0,
        weightedProgress: 0,
        byType: {PH:0, IQ:0, SP:0},
        byTypePotential: {PH:0, IQ:0, SP:0},
      };
      const SCORE_UNIT = 10;

      let wSum = 0;
      let wProg = 0;

      for(const t of tasks){
        const importance = Number(t.importance || 1);
        const weight = importance * SCORE_UNIT;

        const target = Math.max(1, Number(t.target || 1));
        const done = clamp(Number(t.done || 0), 0, target);
        const ratio = target > 0 ? (done / target) : 0;

        totals.scoreTotal += weight;
        totals.scoreDone += weight * ratio;

        const mul = TYPE_META[t.type].multiplier;

        // Radar accumulators (same idea)
        totals.byType[t.type] += weight * ratio;
        totals.byTypePotential[t.type] += weight;

        // ✅ EXP weights (independent of target size)
        const w = importance * mul;
        wSum += w;
        wProg += ratio * w;
      }

      totals.completion = totals.scoreTotal > 0 ? (totals.scoreDone / totals.scoreTotal) : 0;

      const dailyMax = dailyMaxExpByLevel(level);
      totals.expMax = dailyMax;

      totals.weightedProgress = wSum > 0 ? (wProg / wSum) : 0;
      totals.exp = Math.round(totals.weightedProgress * dailyMax);

      return totals;
    }

    function polygon(ctx, cx, cy, r, sides, rot){
      ctx.beginPath();
      for(let i=0;i<sides;i++){
        const a = rot + i*(2*Math.PI/sides);
        const x = cx + Math.cos(a)*r;
        const y = cy + Math.sin(a)*r;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.closePath();
    }

    function RadarCanvas(props){
      const ref = useRef(null);
      const prevRef = useRef({PH:0, IQ:0, SP:0});
      const animRef = useRef(null);

      function draw(vals){
        const canvas = ref.current;
        if(!canvas) return;
        const ctx = canvas.getContext("2d");
        const w = canvas.width, hh = canvas.height;
        ctx.clearRect(0,0,w,hh);

        const cx = w/2, cy = hh/2 + 10;
        const radius = Math.min(w, hh) * 0.33;

        ctx.save();
        ctx.strokeStyle = "rgba(255,255,255,0.12)";
        ctx.lineWidth = 1;

        for(let r=1;r<=4;r++){
          polygon(ctx, cx, cy, radius*(r/4), 3, -Math.PI/2);
          ctx.stroke();
        }

        const labels = ["PH","IQ","SP"];
        const angles = [
          -Math.PI/2,
          -Math.PI/2 + (2*Math.PI/3),
          -Math.PI/2 + (4*Math.PI/3),
        ];

        labels.forEach((lab,i)=>{
          const a = angles[i];
          const x = cx + Math.cos(a)*radius;
          const y = cy + Math.sin(a)*radius;

          ctx.beginPath();
          ctx.moveTo(cx,cy);
          ctx.lineTo(x,y);
          ctx.stroke();

          ctx.fillStyle = "rgba(255,255,255,0.78)";
          ctx.font = "16px IBM Plex Sans Arabic, sans-serif";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(lab, cx + Math.cos(a)*(radius+26), cy + Math.sin(a)*(radius+18));
        });

        const pPH = (vals.PH||0)/100, pIQ = (vals.IQ||0)/100, pSP = (vals.SP||0)/100;
        const arr = [pPH,pIQ,pSP].map((v,i)=>{
          const a = angles[i];
          return { x: cx + Math.cos(a)*radius*v, y: cy + Math.sin(a)*radius*v };
        });

        ctx.beginPath();
        ctx.moveTo(arr[0].x, arr[0].y);
        ctx.lineTo(arr[1].x, arr[1].y);
        ctx.lineTo(arr[2].x, arr[2].y);
        ctx.closePath();

        ctx.fillStyle = "rgba(0,229,255,0.20)";
        ctx.fill();
        ctx.strokeStyle = "rgba(0,229,255,0.88)";
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.fillStyle = "rgba(0,229,255,0.95)";
        arr.forEach(p=>{
          ctx.beginPath();
          ctx.arc(p.x,p.y,4,0,Math.PI*2);
          ctx.fill();
        });

        ctx.restore();
      }

      useEffect(()=>{
        const next = props.values || {PH:0, IQ:0, SP:0};
        const from = prevRef.current;

        if(animRef.current) cancelAnimationFrame(animRef.current);

        const start = performance.now();
        const dur = 320;
        function lerp(a,b,t){ return a + (b-a)*t; }
        function ease(t){ return 1 - Math.pow(1-t, 3); }

        function step(now){
          const t = Math.min(1, (now - start) / dur);
          const k = ease(t);
          const cur = {
            PH: lerp(from.PH, next.PH, k),
            IQ: lerp(from.IQ, next.IQ, k),
            SP: lerp(from.SP, next.SP, k),
          };
          draw(cur);
          if(t < 1) animRef.current = requestAnimationFrame(step);
          else prevRef.current = {PH: next.PH, IQ: next.IQ, SP: next.SP};
        }
        animRef.current = requestAnimationFrame(step);

        return ()=> { if(animRef.current) cancelAnimationFrame(animRef.current); };
      }, [props.values]);

      return h("div", {className:"radar-wrap"},
        h("canvas", {ref, width:520, height:420})
      );
    }

    function CommitChart(props){
      const ref = useRef(null);
      const prevYRef = useRef(null);
      const animRef = useRef(null);

      function draw(points, t=1){
        const canvas = ref.current;
        if(!canvas) return;
        const ctx = canvas.getContext("2d");
        const w = canvas.width, hh = canvas.height;
        ctx.clearRect(0,0,w,hh);

        const pad = 18;
        const innerW = w - pad*2;
        const innerH = hh - pad*2;

        ctx.save();
        ctx.strokeStyle = "rgba(255,255,255,0.10)";
        ctx.lineWidth = 1;
        for(let i=0;i<=4;i++){
          const y = pad + (innerH * (i/4));
          ctx.beginPath(); ctx.moveTo(pad, y); ctx.lineTo(w-pad, y); ctx.stroke();
        }
        ctx.restore();

        if(!points || points.length < 2){
          ctx.fillStyle = "rgba(255,255,255,0.70)";
          ctx.font = "13px IBM Plex Sans Arabic, sans-serif";
          ctx.textAlign = "center";
          ctx.fillText("سيظهر المنحنى بعد أول يوم حفظ تلقائي.", w/2, hh/2);
          return;
        }

        const maxY = Math.max(1, ...points.map(p=>p.y));
        const minY = Math.min(...points.map(p=>p.y));
        const range = Math.max(1, maxY - minY);

        const xs = points.map((p, i)=>{
          const x = pad + (innerW * (i/(points.length-1)));
          const yNorm = (p.y - minY) / range;
          const y = pad + innerH - (yNorm * innerH);
          return {x,y, yVal:p.y};
        });

        const prev = prevYRef.current;
        const ys = xs.map((p,i)=>{
          const py = prev && prev[i] != null ? prev[i] : p.y;
          return { x:p.x, y: py + (p.y - py)*t, yVal:p.yVal };
        });

        ctx.beginPath();
        ctx.moveTo(ys[0].x, ys[0].y);
        for(let i=1;i<ys.length;i++) ctx.lineTo(ys[i].x, ys[i].y);
        ctx.lineTo(ys[ys.length-1].x, hh-pad);
        ctx.lineTo(ys[0].x, hh-pad);
        ctx.closePath();
        ctx.fillStyle = "rgba(0,229,255,0.10)";
        ctx.fill();

        ctx.beginPath();
        ctx.moveTo(ys[0].x, ys[0].y);
        for(let i=1;i<ys.length;i++) ctx.lineTo(ys[i].x, ys[i].y);
        ctx.strokeStyle = "rgba(0,229,255,0.92)";
        ctx.lineWidth = 2.2;
        ctx.stroke();

        ctx.fillStyle = "rgba(0,229,255,0.95)";
        for(const p of ys){
          ctx.beginPath();
          ctx.arc(p.x, p.y, 3.6, 0, Math.PI*2);
          ctx.fill();
        }

        ctx.fillStyle = "rgba(255,255,255,0.70)";
        ctx.font = "12px IBM Plex Sans Arabic, sans-serif";
        ctx.textAlign = "right";
        ctx.fillText(`الآن: ${points[points.length-1].y} يوم`, w-pad, pad+12);

        ctx.textAlign = "left";
        ctx.fillText(`البداية: ${points[0].y} يوم`, pad, pad+12);
      }

      useEffect(()=>{
        const points = props.points || [];
        if(animRef.current) cancelAnimationFrame(animRef.current);

        const start = performance.now();
        const dur = 420;
        function ease(t){ return 1 - Math.pow(1-t, 3); }

        function step(now){
          const tt = Math.min(1, (now - start) / dur);
          draw(points, ease(tt));
          if(tt < 1) animRef.current = requestAnimationFrame(step);
        }
        animRef.current = requestAnimationFrame(step);

        return ()=>{ if(animRef.current) cancelAnimationFrame(animRef.current); };
      }, [props.points]);

      return h("div", {className:"chart-wrap"},
        h("canvas", {ref, width:720, height:280})
      );
    }

    // ✅ منحنى Net EXP
    function ExpChart(props){
      const ref = useRef(null);
      const animRef = useRef(null);

      function draw(points, t=1){
        const canvas = ref.current;
        if(!canvas) return;
        const ctx = canvas.getContext("2d");
        const w = canvas.width, hh = canvas.height;
        ctx.clearRect(0,0,w,hh);

        const pad = 18;
        const innerW = w - pad*2;
        const innerH = hh - pad*2;

        ctx.save();
        ctx.strokeStyle = "rgba(255,255,255,0.10)";
        ctx.lineWidth = 1;
        for(let i=0;i<=4;i++){
          const y = pad + (innerH * (i/4));
          ctx.beginPath(); ctx.moveTo(pad, y); ctx.lineTo(w-pad, y); ctx.stroke();
        }
        ctx.restore();

        if(!points || points.length < 2){
          ctx.fillStyle = "rgba(255,255,255,0.70)";
          ctx.font = "13px IBM Plex Sans Arabic, sans-serif";
          ctx.textAlign = "center";
          ctx.fillText("سيظهر منحنى EXP بعد أول يوم حفظ تلقائي.", w/2, hh/2);
          return;
        }

        const maxY = Math.max(1, ...points.map(p=>p.y));
        const minY = Math.min(...points.map(p=>p.y));
        const range = Math.max(1, maxY - minY);

        const pts = points.map((p,i)=>{
          const x = pad + (innerW * (i/(points.length-1)));
          const yNorm = (p.y - minY) / range;
          const y = pad + innerH - (yNorm * innerH);
          return {x,y, yVal:p.y};
        });

        const shown = pts.map(p=>({x:p.x, y: pad + innerH - ((pad + innerH - p.y) * t), yVal:p.yVal}));

        ctx.beginPath();
        ctx.moveTo(shown[0].x, shown[0].y);
        for(let i=1;i<shown.length;i++) ctx.lineTo(shown[i].x, shown[i].y);
        ctx.lineTo(shown[shown.length-1].x, hh-pad);
        ctx.lineTo(shown[0].x, hh-pad);
        ctx.closePath();
        ctx.fillStyle = "rgba(168,85,247,0.10)";
        ctx.fill();

        ctx.beginPath();
        ctx.moveTo(shown[0].x, shown[0].y);
        for(let i=1;i<shown.length;i++) ctx.lineTo(shown[i].x, shown[i].y);
        ctx.strokeStyle = "rgba(168,85,247,0.92)";
        ctx.lineWidth = 2.2;
        ctx.stroke();

        ctx.fillStyle = "rgba(168,85,247,0.95)";
        for(const p of shown){
          ctx.beginPath();
          ctx.arc(p.x, p.y, 3.6, 0, Math.PI*2);
          ctx.fill();
        }

        ctx.fillStyle = "rgba(255,255,255,0.70)";
        ctx.font = "12px IBM Plex Sans Arabic, sans-serif";
        ctx.textAlign = "right";
        ctx.fillText(`Net EXP الآن: ${Math.round(points[points.length-1].y)}`, w-pad, pad+12);
      }

      useEffect(()=>{
        const points = props.points || [];
        if(animRef.current) cancelAnimationFrame(animRef.current);

        const start = performance.now();
        const dur = 420;
        function ease(t){ return 1 - Math.pow(1-t, 3); }

        function step(now){
          const tt = Math.min(1, (now - start) / dur);
          draw(points, ease(tt));
          if(tt < 1) animRef.current = requestAnimationFrame(step);
        }
        animRef.current = requestAnimationFrame(step);

        return ()=>{ if(animRef.current) cancelAnimationFrame(animRef.current); };
      }, [props.points]);

      return h("div", {className:"chart-wrap"},
        h("canvas", {ref, width:720, height:280})
      );
    }

    function App(){
      const loaded = useMemo(()=>loadState(), []);
      const [state, setState] = useState(()=>{
        const base = {
          day: todayKeyLocal(),
          tasks: [
            { id:"t1", title:"صلاة", target:5, importance:5, type:"SP", done:0 },
            { id:"t2", title:"Push-ups", target:300, importance:4, type:"PH", done:0 },
            { id:"t3", title:"قراءة", target:30, importance:3, type:"IQ", done:0 },
          ],
          totalExp: 0,            // ✅ Net EXP (تزيد/تنقص)
          hp: 100,
          commitDays: 0,
          lastCommitDay: null,
          lockedUntil: null,
          lifetimeByType: { PH:0, IQ:0, SP:0 },
          lifetimePotentialByType: { PH:0, IQ:0, SP:0 },
          commitHistory: [],       // {d, v}
          expHistory: [],          // {d, v}
        };
        if(loaded && typeof loaded === "object") return Object.assign({}, base, loaded);
        return base;
      });

      const [countdownMs, setCountdownMs] = useState(msToMidnight());
      useEffect(()=>{ saveState(state); }, [state]);

      useEffect(()=>{
        const t = setInterval(()=> setCountdownMs(msToMidnight()), 1000);
        return ()=>clearTimeout(t);
      }, []);

      const quote = useMemo(()=>randomQuote(state.day), [state.day]);

      // ✅ level first (same as before, just moved before computeToday usage)
      const level = useMemo(()=>expToLevel(state.totalExp), [state.totalExp]);

      // ✅ computeToday now needs current level
      const computed = useMemo(()=>computeToday(state.tasks, level.level), [state.tasks, level.level]);

      const rank = useMemo(()=>rankFromStreak(state.commitDays), [state.commitDays]);

      const isLocked = useMemo(()=>{
        if(!state.lockedUntil) return false;
        return Date.now() < state.lockedUntil;
      }, [state.lockedUntil, countdownMs]);

      const lockRemaining = useMemo(()=>{
        if(!state.lockedUntil) return null;
        const ms = state.lockedUntil - Date.now();
        if(ms <= 0) return null;
        const hh = Math.floor(ms/(1000*60*60));
        const mm = Math.floor((ms%(1000*60*60))/(1000*60));
        return {hh, mm};
      }, [state.lockedUntil, countdownMs]);

      // Auto finalize at midnight
      useEffect(()=>{
        const ms = msToMidnight();
        const to = setTimeout(()=> finalizeDay(), ms + 80);
        return ()=>clearTimeout(to);
        // eslint-disable-next-line
      }, [state.tasks, state.hp, state.totalExp, state.commitDays, state.day]);

      function updateTask(id, patch){
        setState(prev => Object.assign({}, prev, {
          tasks: prev.tasks.map(t => t.id===id ? Object.assign({}, t, patch) : t)
        }));
      }

      function removeTask(id){
        setState(prev => Object.assign({}, prev, { tasks: prev.tasks.filter(t => t.id!==id) }));
      }

      function addTask(title, target, importance, type){
        const clean = String(title||"").trim();
        if(!clean) return;
        setState(prev => Object.assign({}, prev, {
          tasks: prev.tasks.concat([{
            id:`t${Math.random().toString(16).slice(2)}`,
            title: clean,
            target: clamp(Number(target)||1, 1, 9999),
            importance: Number(importance),
            type: type,
            done: 0
          }])
        }));
      }

      function pushHistory(history, dateKey, value){
        const arr = Array.isArray(history) ? history.slice() : [];
        if(arr.length && arr[arr.length-1].d === dateKey){
          arr[arr.length-1] = { d: dateKey, v: value };
          return arr;
        }
        arr.push({ d: dateKey, v: value });
        return arr;
      }

      function finalizeDay(){
        setState(prev=>{
          // ✅ compute totals with current level (for consistent dailyMax + penalty)
          const currLevel = expToLevel(prev.totalExp).level;
          const totals = computeToday(prev.tasks, currLevel);

          const completion = totals.completion;

          const dayJustClosed = prev.day;
          const newDay = todayKeyLocal();

          const expGained = Math.round(totals.exp);
          const qualifies = completion >= 0.7;
          const failHard = completion < 0.5;

          // HP logic (مثل ما هو)
          const delta = qualifies ? 6 : (failHard ? -12 : -4);
          const hp = clamp(prev.hp + delta, 0, 100);
          const lockedUntil = hp === 0 ? (Date.now() + 24*60*60*1000) : null;

          // CommitDays logic (مثل ما هو)
          const currentRank = rankFromStreak(prev.commitDays).key;
          const penaltyDays = qualifies ? 0 : (RANK_PENALTY[currentRank] ?? 0);
          const commitDays = qualifies ? (prev.commitDays + 1) : Math.max(0, prev.commitDays - penaltyDays);
          const lastCommitDay = qualifies ? dayJustClosed : prev.lastCommitDay;

          // Lifetime radar accumulators (مثل ما هو)
          const lifetimeByType = {
            PH: prev.lifetimeByType.PH + totals.byType.PH,
            IQ: prev.lifetimeByType.IQ + totals.byType.IQ,
            SP: prev.lifetimeByType.SP + totals.byType.SP
          };
          const lifetimePotentialByType = {
            PH: prev.lifetimePotentialByType.PH + totals.byTypePotential.PH,
            IQ: prev.lifetimePotentialByType.IQ + totals.byTypePotential.IQ,
            SP: prev.lifetimePotentialByType.SP + totals.byTypePotential.SP
          };

          // ✅ Net EXP: إذا نجح اليوم تُضاف، إذا فشل تُنقص (قاسية مع الليفل)
          const expPenalty = expPenaltyByLevel(currLevel);
          const totalExp = qualifies
            ? (prev.totalExp + expGained)
            : Math.max(0, prev.totalExp - expPenalty);

          const tasks = prev.tasks.map(t => Object.assign({}, t, {done:0}));

          const commitHistory = pushHistory(prev.commitHistory, dayJustClosed, commitDays);
          const expHistory = pushHistory(prev.expHistory, dayJustClosed, totalExp);

          return Object.assign({}, prev, {
            totalExp, hp, lockedUntil,
            commitDays, lastCommitDay,
            lifetimeByType, lifetimePotentialByType,
            day: newDay, tasks,
            commitHistory, expHistory
          });
        });
      }

      const radarLive = useMemo(()=>{
        const g = state.lifetimeByType;
        const p = state.lifetimePotentialByType;
        const liveGain = { PH: g.PH + computed.byType.PH, IQ: g.IQ + computed.byType.IQ, SP: g.SP + computed.byType.SP };
        const livePot  = { PH: p.PH + computed.byTypePotential.PH, IQ: p.IQ + computed.byTypePotential.IQ, SP: p.SP + computed.byTypePotential.SP };
        const ph = livePot.PH>0 ? liveGain.PH/livePot.PH : 0;
        const iq = livePot.IQ>0 ? liveGain.IQ/livePot.IQ : 0;
        const sp = livePot.SP>0 ? liveGain.SP/livePot.SP : 0;
        return { PH: Math.round(ph*100), IQ: Math.round(iq*100), SP: Math.round(sp*100) };
      }, [state.lifetimeByType, state.lifetimePotentialByType, computed.byType, computed.byTypePotential]);

      const commitPoints = useMemo(()=>{
        const hist = Array.isArray(state.commitHistory) ? state.commitHistory : [];
        return hist.map((x,i)=>({ x:i, y:Number(x.v||0), d:x.d }));
      }, [state.commitHistory]);

      const expPoints = useMemo(()=>{
        const hist = Array.isArray(state.expHistory) ? state.expHistory : [];
        return hist.map((x,i)=>({ x:i, y:Number(x.v||0), d:x.d }));
      }, [state.expHistory]);

      const [newTitle, setNewTitle] = useState("");
      const [newTarget, setNewTarget] = useState(10);
      const [newImportance, setNewImportance] = useState(3);
      const [newType, setNewType] = useState("PH");

      const expPenaltyPreview = useMemo(()=>expPenaltyByLevel(level.level), [level.level]);

      return h("div", {className:"wrap"},
        h("header", {className:"header"},
          h("div", {className:"hero-glow"}),
          h("div", {className:"top-row"},
            h("div", null,
              h("div", {className:"badge"},
                h("span", {className:"dot"}),
                h("span", {className:"brand-name"}, "RISE SYSTEM™"),
                h("span", {className:"brand-sub"}, "Personal Evolution")
              ),
              h("h1", {className:"title"}, "طوّر شخصيتك… مثل الأنمي"),
              h("p", {className:"subtitle"}, "أضفنا: EXP متناسقة بين المهام (نِسَب + أهمية + نوع) + عقوبة قاسية جدًا بالمستويات المتقدمة."),
              h("div", {className:"chips"},
                h("div", {className:"chip"}, h("span", null, "اليوم:"), h("span", {className:"chip-mono"}, state.day)),
                state.lastCommitDay ? h("div", {className:"chip"}, h("span", null, "آخر يوم محسوب:"), h("span", {className:"chip-mono"}, state.lastCommitDay)) : null
              ),
              h("div", {className:"countdown"},
                h("div", {className:"muted"}, "الحفظ التلقائي بعد:"),
                h("div", {className:"mono"}, formatCountdown(countdownMs))
              )
            ),

            h("div", {className:"stats"},
              h("div", {className:"stat stat-hp"},
                h("div", {className:"stat-k"}, "HP"),
                h("div", {className:"stat-v"}, `${state.hp}/100`),
                h("div", {className:"stat-s"}, state.hp===0 ? "قفل 24 ساعة" : (state.hp>=70 ? "مستقر" : "خطر"))
              ),
              h("div", {className:"stat stat-level"},
                h("div", {className:"stat-k"}, "LEVEL"),
                h("div", {className:"stat-v"}, String(level.level)),
                h("div", {className:"stat-s"}, `${level.expIntoLevel}/${level.expForNext} EXP`)
              ),
              h("div", {className:"stat stat-rank"},
                h("div", {className:"stat-k"}, "RANK"),
                h("div", {className:"stat-v"}, rank.label),
                h("div", {className:"stat-s"}, `${state.commitDays} يوم التزام`)
              )
            )
          ),

          isLocked ? h("div", {className:"locked"},
            h("div", {className:"locked-row"},
              h("div", null, "تم قفل الدخول مؤقتًا بسبب HP = 0."),
              h("div", {className:"mono"}, lockRemaining ? `متبقي ${lockRemaining.hh}h ${lockRemaining.mm}m` : "...")
            )
          ) : null
        ),

        h("main", {className:"main"},
          h("section", null,
            h("div", {className:"card"},
              h("div", {className:"card-row"},
                h("div", null,
                  h("div", {className:"label"}, "QUOTE OF THE DAY"),
                  h("div", {className:"quote"}, `“${quote}”`),
                  h("div", {className:"muted", style:{marginTop:8}}, "اليوم يُغلق تلقائيًا عند 00:00.")
                ),
                h("button", {
                  className:"btn btn-ghost",
                  disabled:isLocked,
                  onClick:()=>setState(p=>Object.assign({},p,{day:todayKeyLocal()}))
                }, "تحديث اليوم")
              )
            ),

            h("div", {className:"card"},
              h("div", {className:"progress-row"},
                h("div", null,
                  h("div", {className:"label"}, "TODAY PROGRESS"),
                  h("div", {className:"big"}, `${pct(computed.completion)}%`),
                  h("div", {className:"muted"}, `EXP اليوم (إذا ≥70%): +${Math.round(computed.exp)} / سقف اليوم: ${Math.round(computed.expMax)}`),
                  h("div", {className:"muted", style:{marginTop:6}}, `عقوبة Net EXP إذا <70% (قاسية حسب Level): -${expPenaltyPreview}`)
                ),
                h("div", {className:"progress-side"},
                  h("div", {className:"bar"},
                    h("div", {className:"fill", style:{width:`${pct(computed.completion)}%`}})
                  ),
                  h("div", {className:"tiny", style:{marginTop:8}},
                    h("span", null, "≥ 70% يزيد HP + يُحسب يوم"),
                    h("span", null, "< 70% = خصم Net EXP")
                  )
                )
              ),

              h("div", {className:"task-list"},
                state.tasks.map(t=>{
                  const target = Math.max(1, Number(t.target||1));
                  const done = clamp(Number(t.done||0), 0, target);
                  const itemPct = target>0 ? (done/target)*100 : 0;
                  const typeClass = t.type==="PH" ? "ph" : (t.type==="IQ" ? "iq" : "sp");
                  return h("div", {className:"task", key:t.id},
                    h("div", {className:"task-top"},
                      h("div", {style:{minWidth:0}},
                        h("div", {style:{display:"flex", alignItems:"center", gap:10, flexWrap:"wrap"}},
                          h("span", {className:`tag ${typeClass}`}, `${t.type} • imp ${t.importance}/5`),
                          h("div", {className:"task-title", title:t.title}, t.title)
                        ),
                        h("div", {className:"task-meta"},
                          h("span", null, `Target: ${t.target}`),
                          h("span", null, `Done: ${t.done}`),
                          h("span", null, `Progress: ${pct(itemPct/100)}%`)
                        )
                      ),
                      h("div", {className:"task-controls"},
                        h("div", {className:"bar", style:{width:160}},
                          h("div", {className:"fill", style:{width:`${itemPct}%`}})
                        ),
                        h("input", {
                          className:"input small",
                          type:"number",
                          min:0,
                          step:1,
                          value:t.done,
                          disabled:isLocked,
                          onChange:(e)=>updateTask(t.id, {done: clamp(Number(e.target.value||0), 0, 999999)})
                        }),
                        h("button", {className:"btn", disabled:isLocked, onClick:()=>removeTask(t.id), title:"Remove"}, "✕")
                      )
                    )
                  );
                })
              )
            ),

            h("div", {className:"card"},
              h("div", {className:"label"}, "ADD TASK"),
              h("div", {className:"section-title"}, "مهمة جديدة"),
              h("div", {className:"muted"}, "الأهمية هي التي تتحكم في الإنصاف."),
              h("div", {className:"add-grid"},
                h("input", {className:"input", value:newTitle, disabled:isLocked, placeholder:"مثال: دراسة / قرآن / جري", onChange:(e)=>setNewTitle(e.target.value)}),
                h("input", {className:"input", type:"number", min:1, value:newTarget, disabled:isLocked, onChange:(e)=>setNewTarget(Number(e.target.value||1))}),
                h("select", {className:"input", value:String(newImportance), disabled:isLocked, onChange:(e)=>setNewImportance(Number(e.target.value))},
                  [1,2,3,4,5].map(v=>h("option",{key:v,value:String(v)},String(v)))
                ),
                h("select", {className:"input", value:newType, disabled:isLocked, onChange:(e)=>setNewType(e.target.value)},
                  ["PH","IQ","SP"].map(v=>h("option",{key:v,value:v},v))
                ),
                h("button", {className:"btn btn-green", disabled:isLocked, onClick:()=>{
                  addTask(newTitle, newTarget, newImportance, newType);
                  setNewTitle(""); setNewTarget(10); setNewImportance(3); setNewType("PH");
                }}, "+")
              )
            ),

            h("div", {className:"card"},
              h("div", {className:"label"}, "COMMIT STATS"),
              h("div", {className:"section-title"}, "أيام الالتزام الحالية + منحناها"),
              h("div", {className:"mini-stats"},
                h("div", {className:"mini"},
                  h("div", {className:"mini-v"}, state.commitDays, h("span", null, " يوم")),
                  h("div", {className:"mini-l"}, "Commit Days (Live)")
                ),
                h("div", {className:"mini"},
                  h("div", {className:"mini-v"}, rank.label),
                  h("div", {className:"mini-l"}, "RANK الحالي")
                ),
                h("div", {className:"mini"},
                  h("div", {className:"mini-v"}, `${commitPoints.length}`, h("span", null, " يوم")),
                  h("div", {className:"mini-l"}, "أيام مسجلة بالمنحنى")
                )
              ),
              h(CommitChart, {points: commitPoints})
            ),

            h("div", {className:"card"},
              h("div", {className:"label"}, "NET EXP"),
              h("div", {className:"section-title"}, "صافي EXP المتراكمة + منحناها"),
              h("div", {className:"muted"}, "تزيد إذا اليوم ≥70%، وتنقص إذا <70% بعقوبة قاسية تتصاعد مع الـ Level."),
              h("div", {className:"mini-stats"},
                h("div", {className:"mini"},
                  h("div", {className:"mini-v"}, Math.round(state.totalExp)),
                  h("div", {className:"mini-l"}, "Net EXP (Live)")
                ),
                h("div", {className:"mini"},
                  h("div", {className:"mini-v"}, level.level),
                  h("div", {className:"mini-l"}, "Level (يتأثر مباشرة)")
                ),
                h("div", {className:"mini"},
                  h("div", {className:"mini-v"}, `-${expPenaltyPreview}`),
                  h("div", {className:"mini-l"}, "عقوبة اليوم إذا فشل")
                )
              ),
              h(ExpChart, {points: expPoints})
            )
          ),

          h("aside", null,
            h("div", {className:"card"},
              h("div", {className:"label"}, "RADAR"),
              h("div", {className:"section-title"}, "إحصائياتك الكلية (Live)"),
              h("div", {className:"muted"}, "All-time + Today live (يتحدّث فورًا)."),
              h(RadarCanvas, {values: radarLive}),
              h("div", {className:"mini-stats"},
                h("div", {className:"mini"},
                  h("div", {className:"mini-v"}, radarLive.PH, h("span", null, "%")),
                  h("div", {className:"mini-l"}, TYPE_META.PH.label)
                ),
                h("div", {className:"mini"},
                  h("div", {className:"mini-v"}, radarLive.IQ, h("span", null, "%")),
                  h("div", {className:"mini-l"}, TYPE_META.IQ.label)
                ),
                h("div", {className:"mini"},
                  h("div", {className:"mini-v"}, radarLive.SP, h("span", null, "%")),
                  h("div", {className:"mini-l"}, TYPE_META.SP.label)
                )
              )
            ),

            h("div", {className:"card"},
              h("div", {className:"label"}, "SYSTEM NOTES"),
              h("div", {className:"note"}, "• اليوم يُغلق تلقائيًا عند 00:00 ويحفظ النتائج."),
              h("div", {className:"note"}, "• الإنجاز عادل: يعتمد على Importance (وزن المهمة) وليس على Target."),
              h("div", {className:"note"}, "• HP Rule: إذا ≥ 70% ⇒ +6 HP + يُحسب يوم التزام. إذا بين 50% و 69% ⇒ -4 HP. إذا < 50% ⇒ -12 HP."),
              h("div", {className:"note"}, "• إذا HP وصل 0 ⇒ قفل 24 ساعة."),
              h("div", {className:"note"}, "• Net EXP: إذا ≥70% تُضاف EXP اليوم، وإذا <70% تُخصم EXP بعقوبة قاسية تزيد مع الـ Level."),
              h("div", {className:"note"}, "• RANK حسب أيام الالتزام: D=7، C=30، B=90، A=180، S=365."),
              h("div", {className:"note"}, "• عقوبة الرانك عند عدم الالتزام: تنقص أيام الالتزام حسب رتبتك (E=0, D=1, C=3, B=7, A=14, S=30).")
            )
          )
        ),

        h("footer", {className:"footer"},
          h("div", null, "حفظ دائم داخل المتصفح (LocalStorage)."),
          h("div", null, "RISE SYSTEM™ — Solo Leveling vibes, لكن بالواقع.")
        )
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(h(App));
  </script>
</body>
</html>
